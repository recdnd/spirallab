<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="spiral-favicon-32.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="color-scheme" content="light dark">
  <title>Spiral Lab</title>
  <style>
    body {
      background: white;
      color: red;
      font-family: 'Courier New', monospace;
  		padding-top: 3.6rem;
		  padding-left: 2rem;
		  padding-right: 2rem;
		  padding-bottom: 2rem;
      max-width: 960px;
    }
    h1 {
      font-size: 1.8rem;
      border-bottom: 2px dashed red;
    }
    h1 img {
		  height: 5rem; /* åŸç‚º 1.4remï¼Œå¯è¦–éœ€è¦å¾®èª¿ */
		  max-width: 180px; /* é™åˆ¶å¯¬åº¦ */
		  vertical-align: middle;
		  margin-right: 0.6rem;
		}
		.top-controls {
		  position: fixed;
		  top: 1rem;
		  right: 2rem;
		  display: flex;
		  gap: 1rem;
		  z-index: 100;
		}
		
		.stars-bar {
		  background: white;
		  border: 1px dashed red;
		  font-size: 16px;
      padding: 4px 12px;
		  border-radius: 4px;
		  display: flex;
		  align-items: center;
		  gap: 0.3rem;                 /* âœ… åŠ é»é–“è·è®“æ˜Ÿæ˜Ÿä¸é» */
		}
		
		.stars-bar span {
		  cursor: pointer;
		  padding: 0 3px;             /* ğŸ”½ åŸæœ¬ 0 4pxï¼Œç•¥ç¸®æ¸› */
		}
		
		.stars-bar span.active {
		  background: red;
		  color: white;
		}
		
		.lang-toggle {
		  font-weight: bold;
		  cursor: pointer;
		  border: 1px dashed red;
		  font-size: 14px;
		  padding: 6px 14px;
		  color: red;
		  background: white;
		  border-radius: 4px;
		  align-self: center;
		}
		
		.lang-toggle:hover {
		  background: red;
		  color: white;
		}
    .timeline {
      position: fixed;
      top: 6rem;
      right: 4rem;
      width: 150px;
      border-left: 2px dashed red;
      padding-left: 10px;
    }
    .timeline .node {
      font-size: 0.8rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }
    .tag-index {
      margin: 1rem 0;
    }
    .tag-index button {
      border: 1px solid red;
      padding: 4px 10px;
      margin: 4px 6px 4px 0;
      font-size: 0.75rem;
      border-radius: 4px;
      background: white;
      color: red;
      cursor: pointer;
    }
    .tag-index button.active {
      background: red;
      color: white;
    }
    .popup-menu button.active {
		  background: red;
		  color: white;
		}
    .card {
      border: 1px dashed red;
      padding: 1rem;
      margin-bottom: 2rem;
      background: #fff0f0;
      border-radius: 4px;
      position: relative;
    }
/* 
.card[data-weight="5"] {
  box-shadow: 0 0 6px 2px red;
}
*/
    .layer-toggle-btn {
		  position: absolute;
		  bottom: 6px;
		  right: 10px;
		  font-size: 1.1rem;
		  color: red;
		  cursor: pointer;
		  user-select: none;
		}
		.card-layer-block {
		  display: none;
		  margin-top: 0.8rem;
		  border-top: 1px dashed red;
		  padding-top: 0.6rem;
		}
		.card-layer-title {
		  color: red;
		  font-weight: normal;
		  font-size: 0.95rem;
		  margin-top: 0.6rem;
		  margin-bottom: 0.2rem;
		}
		.card-layer-content {
		  font-size: 0.85rem;
		  white-space: pre-wrap;
		  line-height: 1.45;
		  margin-bottom: 1.2rem;
		}
    .card.hidden {
      display: none;
    }
    .card-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .card-meta {
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }
    .card-section {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }
		span.codeblock {
		  background-color: #fffbfb; /* âœ… ç™½ + 80% é€æ˜ï¼Œä¸æœƒå®Œå…¨æ¶ˆå¤± */
		  color: red;
		  padding: 1px 4px;
		  border-radius: 0px;
		  font-family: 'Courier New', monospace;
		  font-size: 0.9em;
		  white-space: nowrap;
		  border: none;
		}

		
		span.codeblock.green {
		  color: #00ff66;  /* ğŸŸ¢ è¢å…‰ç¶ å­— */
		}


    .tag {
      display: inline-block;
      border: 1px solid red;
      padding: 2px 6px;
      margin-right: 6px;
      margin-bottom: 4px;
      font-size: 0.75rem;
      border-radius: 4px;
    }
    
		.lab-header {
		  display: flex;
		  align-items: baseline;               /* å¾®æ“å•Ÿå‹• å°é½Šæ–‡å­—åº•ç·š */
		  position: relative;
		  padding-bottom: 0.3rem;              /* ç‚ºç´…ç·šç•™ç©ºé–“ */
		  margin-bottom: 0.5rem;
		}
		
		.logo-block {
		  margin-right: 1rem;
		}
		
		.logo-block img {
		  height: 5.3rem;
		  vertical-align: bottom;
		  object-fit: contain;
		  transform: translateY(2.1rem); /* âœ… åŠ é€™ä¸€è¡Œå‘ä¸‹å¾®å£“ */
		}

		
		.title-block {
		  display: flex;
		  flex-direction: column;
		  justify-content: flex-start;
		  
		  padding-top: 0rem;
		}
		
		.main-title {
		  font-size: 2rem;
		  font-weight: bold;
		  color: red;
		  font-family: 'Courier New', monospace;
		  line-height: 1.1;
		}
		
		.sub-title {
		  font-size: 0.7rem;
		  color: red;
		  margin-top: -0.1rem;
		  margin-left: -0.4rem;
		  line-height: 1.6;
		  margin-bottom: 0.2rem; /*å’Œtitleæ­£é«”ä¸Šç§»æ”¹é€™è£¡ï¼*/
		  padding-bottom: 0.2rem; /* è²¼ç·šä¸‹å£“ */
		}
		
		/* âœ¨ çµ•å°ç´…è™›ç·šï¼Œä½ç½®å›ºå®šåœ¨æ–‡å­— block åº•éƒ¨ */
		.lab-underline {
		  left: 0;
		  height: 0;
		  width: 100%;
		  pointer-events: none;
		  border-bottom: 2px dashed red;
  		margin-top: -0.2rem; /* å¯èª¿æ•´ */
		}

		.footer-bar {
		  position: fixed;
		  bottom: 0;
		  left: 0;
		  width: 100%;
		  z-index: 1000;
		  background: red;
		  color: white;
		  font-family: 'Courier New', monospace;
		  font-size: 0.75rem;
		  text-align: center;
		  white-space: nowrap;
		  overflow: hidden;
		  margin: 0;
		  padding: 0;
		  line-height: 1;
		}

		.spiral-logo {
		  transition: transform 0.6s ease-in-out;
		}
		
		.spiral-logo:hover {
		  animation: spin 2s linear infinite;
		}
.lab-header {
  font-size: 0; /* æ¸…é™¤ inline é–“éš™ */
  white-space: nowrap;
}

.lab-top {
  display: flex;
  align-items: flex-end;  /* âœ… å°é½Šæ–‡å­—åº•ç·š */
  gap: 1rem;
}

.lab-underline {
  margin-top: -1.2rem;
  height: 0;
  width: 100%;
  border-bottom: 2px dashed red;
  
}


.logo-anchor {
  display: inline-block;
  height: 5.3rem;
  vertical-align: middle;
}

.spiral-logo {
  height: 5.3rem;
  display: block;
  transition: transform 0.6s ease-in-out;
  transform-origin: center center;
}

.spiral-logo:hover {
  animation: spin 5s linear infinite;
}

.title-block {
  display: inline-block;
  vertical-align: middle;
  padding-left: 0rem;
}


    		/* åœ“éµå€å®¹å™¨ */
		.mobile-float-buttons {
		  position: fixed;
		  top: 5rem;
		  right: 1rem;
		  display: flex;
		  flex-direction: column;
		  gap: 0.6rem;
		  z-index: 999;
		}
		
		/* ç´…ç·šåœ“éµ */
		.circle-button {
		  width: 36px;
		  height: 36px;
		  font-size: 20px;
		  line-height: 38px;
		  border-radius: 50%;
		  border: 2px dashed red;
		  color: red;
		  background: white;
		  text-align: center;
		  cursor: pointer;
		}
		
		/* å±•é–‹å¾Œ overlay æ¨£å¼ */
		.overlay-menu {
		  position: absolute;       /* âœ… ç”¨ absolute æ‰èƒ½åƒç…§çˆ¶å…ƒç´ ä½ç½® */
		  top: 50%;                 /* âœ… ç½®ä¸­å°é½Šçˆ¶å®¹å™¨ */
		  right: 3.6rem;
		  transform: translateY(-50%);  /* âœ… å‚ç›´å±…ä¸­æ–¼æŒ‰éˆ• */
		  width: 240px;
		  background: white;
		  border: 1px dashed red;
		  padding: 1rem;
		  z-index: 999;
		  max-height: 60vh;
		  overflow-y: auto;
		  font-size: 0.9rem;
		}
		.circle-wrapper {
		  position: relative;
		}
		
		.popup-menu {
		  position: absolute;
		  top: 50%;
		  right: 120%;
		  transform: translateY(-50%);
		  width: 240px;
		  background: white;
		  border: 1px dashed red;
		  padding: 1rem;
		  z-index: 999;
		  max-height: 17vh;
		  overflow-y: auto;
		  font-size: 0.9rem;
		  display: none;
		  
		}
		
		.mobile-sigil {
		  display: none;
		  font-size: 0.75rem;
		  color: red;
		  font-family: 'Courier New', monospace;
		  text-align: center;
		  padding: 0.4rem 0;
		  border-bottom: 1px dashed red;
		}
		@keyframes spin {
		  from {
		    transform: rotate(360deg);
		  }
		  to {
		    transform: rotate(0deg);
		  }
		}
		@media (max-width: 768px) {
		  .mobile-sigil {
		    display: block;
		  }
		}

    @media (max-width: 768px) {
	  .timeline,
	  .tag-index {
	    display: none;
	  }
	}
		@media (max-width: 768px) {
		  .main-title {
		    font-size: 1.4rem;  /* åŸç‚º 1.8rem */
		  }
		
		  .sub-title {
		    font-size: 0.66rem; /* åŸç‚º 0.85rem */
		  }
		
		  .logo-block img {
		    height: 4rem;        /* åŸç‚º 5.3rem */
		    transform: translateY(1.6rem);  /* è·Ÿè‘—ä¸‹å£“èª¿æ•´ */
		  }
		}
		
			@media (prefers-color-scheme: dark) {
		  body {
		    background: black;
		    color: red;
		  }
		
		  .card {
		    background: #1a0000;
		    color: red;
		    border-color: red;
		  }
			#cardContainer {
		  padding-bottom: 3rem;  /* â­ é˜²æ­¢è¢«å›ºå®šåº•éƒ¨çš„ sus è“‹ä½ */
			}

		  .tag {
		    border-color: red;
		    color: red;
		  }
		
		  .lang-toggle, .circle-button {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		}
		
		@media (prefers-color-scheme: dark) {
		  .spiral-logo {
		    animation: nightDrift 42s linear infinite;
		  }
		}
		
		@keyframes nightDrift {
		  from { transform: rotate(0deg); }
		  to   { transform: rotate(-360deg); } /* é€†æ™‚é‡ç·©è½‰ */
		}
		
		@media (prefers-color-scheme: dark) {
		  .stars-bar {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .lang-toggle:hover,
		  .circle-button:hover {
		    background: red;
		    color: black;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .popup-menu,
		  .overlay-menu {
		    background: black;
		    border-color: red;
		    color: red;
		  }
		
		  .tag-index button {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		
		  .tag-index button.active {
		    background: red;
		    color: black;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .footer-bar {
		    background: linear-gradient(to right, red, black, red);
		    color: white;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .card {
		    animation: fadeIn 0.4s ease-in;
		  }
		}
		
		@keyframes fadeIn {
		  from { opacity: 0; transform: translateY(0.6rem); }
		  to { opacity: 1; transform: translateY(0); }
		}
		

  </style>
</head>
<body>


<div class="lab-header">
  <div class="lab-top">
    <span class="logo-anchor">
      <img src="spiral logo.png" class="spiral-logo" />
    </span>
    <span class="title-block">
      <div class="main-title" id="lab-title">Spiral lab</div>
      <div class="sub-title" id="lab-sub">Conductor: Entacle Assembly</div>
    </span>
  </div>
</div>



  <div class="lab-underline"></div> <!-- ç²¾æº–ç´…ç·š -->
</div>
<div class="mobile-sigil"> </div>

<!-- â­ æ˜Ÿæ¢ï¼ˆå³ä¸Šè§’æ§åˆ¶æ¢ ï¼‰+ èªè¨€åˆ‡æ›éˆ• -->
<div class="top-controls">
  <div class="stars-bar" id="stars-bar">
    <span data-star="1">â˜†</span>
    <span data-star="2">â˜†</span>
    <span data-star="3">â˜†</span>
    <span data-star="4">â˜†</span>
    <span data-star="5">â˜†</span>
  </div>
  <div class="lang-toggle" id="langToggle"></div>
</div>

<!-- â² ç¹©ç‹€æ™‚é–“è»¸å®¹å™¨ï¼ˆå³å´ï¼‰ -->
<div class="timeline" id="timeline">
  <!-- JS å‹•æ…‹ç”Ÿæˆç¯€é» -->
</div>

<!-- ğ–¤˜ Tag ç¯©é¸æŒ‰éˆ•å®¹å™¨ -->
<div class="tag-index" id="tag-index">
  <!-- JS å‹•æ…‹ç”Ÿæˆ Tags -->
</div>

<!-- ğŸ“„ å¡ç‰‡å®¹å™¨ -->
<div id="cardContainer">
  <!-- JS å‹•æ…‹ç”Ÿæˆå¡ç‰‡ -->
</div>
<!-- susæ“´æ•£footer -->
<div class="footer-bar">â˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†</div>

<!-- å³ä¸Šè§’ï¼šå°åœ“éµå€ï¼Œå·²åŒ…æˆå°é½Šå–®å…ƒ -->
<div class="mobile-float-buttons">
  <div class="circle-wrapper">
    <div class="circle-button" id="toggleTag">ğ–¤˜</div>
    <div class="popup-menu" id="tagMenu" style="display: none;"></div>
  </div>
  <div class="circle-wrapper">
    <div class="circle-button" id="toggleTime">â²ï¸</div>
    <div class="popup-menu" id="timeMenu" style="display: none;"></div>
  </div>
</div>

<!-- å°æ‡‰å±•é–‹çš„ overlay å€ -->
<div class="overlay-menu" id="timeMenu" style="display: none;"></div>


<script>
const labels = {
  zh: {
    abstract: "æ‘˜è¦",
    scope: "æ‡‰ç”¨ç¯„åœ",
    citation: "å¼•ç”¨èªå¼",
    fragments: "é—œè¯ Fragment",
    tags: "Tags",
    category: "åˆ†é¡",
    author: "ä½œè€…",
    epoch: "ç´€å…ƒ",
    weight: "æ¬Šé‡"
  },
  en: {
    abstract: "Abstract",
    scope: "Scope",
    citation: "Citation",
    fragments: "Related Fragments",
    tags: "Tags",
    category: "Category",
    author: "Author",
    epoch: "Epoch",
    weight: "Weight"
  }
};
// å¡ç‰‡æ•¸æ“šï¼ˆæœªä¾†å¯å¾ .txt è‡ªå‹•è¼‰å…¥ï¼‰
let cardData = [];

function attachLayerToggle() {
  const toggles = document.querySelectorAll('.layer-toggle-btn');
  toggles.forEach(btn => {
    const contentBlock = btn.nextElementSibling;
    btn.onclick = () => {
      const isOpen = contentBlock.style.display === 'block';
      contentBlock.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? '+' : '-';
    };
  });
}

// DOM ç¯€é»æº–å‚™
const container = document.getElementById('cardContainer');
const tagIndex = document.getElementById('tag-index');
const timeline = document.getElementById('timeline');
const starBar = document.getElementById('stars-bar');

let activeTags = new Set();
let minStars = 4;


function highlightCoreSyntax(text) {
  if (!text) return '';

  // ğŸ›¡ï¸ Escape HTML
  text = text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");

  // ğŸŸ© å°ˆè™•ç† <core>
  text = text.replace(/&lt;core&gt;/g, `%%core%%`);

  // ğŸ” å…¨åŸŸåå¼•è™ŸåŒ…è£¹èªç´  â†’ ç™½åº• codeblock
  text = text.replace(/`([^`]+?)`/g, (_, inner) => {
    if (inner === '%%core%%') return `<span class="codeblock green">&lt;core&gt;</span>`;
    return `<span class="codeblock">${inner}</span>`;
  });

  return text;
}




function renderCards() {
  container.innerHTML = '';
  timeline.innerHTML = '';
  let allTags = new Set();

  cardData.forEach((card) => {
    if (card.weight < minStars) return;
    if (activeTags.size > 0 && !card.tags.some(t => activeTags.has(t))) return;

    const div = document.createElement('div');
    div.className = 'card';
    div.dataset.weight = card.weight;
    div.id = card.id;

    // é çµ„è£ layer HTMLï¼ˆé¿å…åµŒå¥—æ¨¡æ¿å­—ä¸²äº‚æ‰ï¼‰
    let layerHTML = '';
    if (card.layers.length > 0) {
      layerHTML += `<div class="layer-toggle-btn">+</div>`;
			layerHTML += `<div class="card-layer-block" style="display:none;">`;
      card.layers.forEach(layer => {
			  layerHTML += `<div class="card-layer-title">[+ ${layer.name}]</div>`;
			  layerHTML += `<div class="card-layer-content">${highlightCoreSyntax(layer.content.trim())}</div>`;
			});
      layerHTML += `</div>`;
    }

    div.innerHTML = `
      <div class="card-title">${card.id} Â· ${card.title}</div>
			<div class="card-meta">
			  ${labels[lang].category}ï¼š${card.category}ï½œ
			  ${labels[lang].epoch}ï¼š${card.epoch || 'â€”'}ï½œ
			  ${labels[lang].author}ï¼š${card.author}ï½œ
			  ${labels[lang].weight}ï¼š${'â˜…'.repeat(card.weight)}${'â˜†'.repeat(5 - card.weight)}
			</div>
			<div class="card-section"><strong>${labels[lang].abstract}ï¼š</strong><br>${highlightCoreSyntax(card.abstract)}</div>
			<div class="card-section"><strong>${labels[lang].scope}ï¼š</strong><br>${highlightCoreSyntax(card.scope)}</div>
			<div class="card-section"><strong>${labels[lang].citation}ï¼š</strong><br>${highlightCoreSyntax(card.citation)}</div>
			<div class="card-section"><strong>${labels[lang].fragments}ï¼š</strong><br>${highlightCoreSyntax(card.fragments)}</div>

      ${layerHTML}
    `;

    container.appendChild(div);

    // timeline
    const node = document.createElement('div');
    node.className = 'node';
    node.textContent = `${card.epoch} â†’ ${card.id}`;
    node.onclick = () => document.getElementById(card.id).scrollIntoView({ behavior: 'smooth' });
    timeline.appendChild(node);

    // æ”¶é›† tag
    card.tags.forEach(t => allTags.add(t));
  });

  // æ›´æ–° tag åˆ—
  tagIndex.innerHTML = '';
  allTags.forEach(tag => {
    const btn = document.createElement('button');
    btn.textContent = tag;
    btn.dataset.tag = tag;
    if (activeTags.has(tag)) btn.classList.add('active');
    btn.onclick = () => {
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        btn.classList.remove('active');
      } else {
        activeTags.add(tag);
        btn.classList.add('active');
      }
      renderCards();
    };
    tagIndex.appendChild(btn);
  });

  // ğŸ”§ ç‚ºæ–°ç”Ÿæˆå¡ç‰‡æ›ä¸Š layer toggle åŠŸèƒ½
  attachLayerToggle();
}
  

// ğŸ”§ æ˜Ÿæ¢æ»‘å‹•é‚è¼¯ï¼šhover æ™‚é¡¯ç¤ºå°æ‡‰äº®æ˜Ÿï¼Œé»æ“Šè¨­å®š minStars
const stars = starBar.querySelectorAll('span');

stars.forEach((span, index) => {
  span.addEventListener('mouseenter', () => {
    highlightStars(index + 1);
  });
  span.addEventListener('click', () => {
    minStars = index + 1;
    renderCards();
  });
});

starBar.addEventListener('mouseleave', () => {
  highlightStars(minStars);
});

function highlightStars(count) {
  stars.forEach((s, i) => {
    s.textContent = i < count ? 'â˜…' : 'â˜†';
  });
}

highlightStars(minStars);
fragLoader('en');

function fragLoader(lang = 'zh') {
  fetch(`/registry/${lang}/index.txt`)
    .then(res => res.text())
    .then(list => {
      const files = list.trim().split('\n');
      const fetches = files.map(file =>
        fetch(`/registry/${lang}/${file.trim()}`).then(res => res.text())
      );
      return Promise.all(fetches);
    })
    .then(allTexts => {
      cardData = allTexts.map(txt => {
        const lines = txt.trim().split('\n');
        const block = {};
        let currentKey = null;
        let buffer = [];
        let layers = [];

        lines.forEach(line => {
          const layerMatch = line.match(/^\[\+Layer:\s*(.+?)\]$/);
          const match = line.match(/^\[(.*?)\]\s*(.*)$/);

          if (layerMatch) {
            if (currentKey) {
              block[currentKey] = buffer.join('\n').trim();
              currentKey = null;
              buffer = [];
            }
            currentKey = null;
            buffer = [];
            layers.push({ name: layerMatch[1], content: '' });
          } else if (match) {
            if (currentKey) {
              block[currentKey] = buffer.join('\n').trim();
            }
            currentKey = match[1];
            buffer = [match[2]];
          } else {
            if (layers.length > 0 && !currentKey) {
              layers[layers.length - 1].content += line + '\n';
            } else if (currentKey) {
              buffer.push(line);
            }
          }
        });

        if (currentKey) {
          block[currentKey] = buffer.join('\n').trim();
        }

        return {
          id: block['ID'] || '',
          title: block['Title'] || '',
          category: block['Category'] || '',
          author: block['Author'] || '',
          epoch: block['Epoch'] || '', 
          weight: (block['Weight'] || 'â˜…â˜…â˜…â˜†â˜†').replace(/[^â˜…]/g, '').length,
          abstract: block['Abstract'] || '',
          scope: block['Scope'] || '',
          citation: block['Citation'] || '',
          fragments: block['Fragments'] || '',
          tags: (block['Tags'] || '').split(/\s+/).filter(t => t.startsWith('#')),
          layers: layers
        };
      });

      renderCards();
    });
}


let lang = 'en';

// åˆå§‹åŒ–en
document.getElementById('langToggle').innerText = 'âš’ï¸ ???';  // èªå ´åˆå§‹åŒ–ä¸­
setTimeout(() => {
document.getElementById('langToggle').innerText = lang === 'zh' ? 'âš’ï¸ En' : 'âš’ï¸ ç¹';
}, 1000);

document.getElementById('langToggle').onclick = () => {
  lang = lang === 'zh' ? 'en' : 'zh';
  document.getElementById('langToggle').innerText = lang === 'zh' ? 'âš’ï¸ En' : 'âš’ï¸ ç¹';

  // âœ… é¡¯ç¤ºä¸åŒæ¨™é¡Œå’Œå­æ¨™
  if (lang === 'zh') {
    document.getElementById('lab-title').textContent = 'èªèºå¯¦é©—å®¤';
    document.getElementById('lab-sub').textContent = 'æ“ä½œå“¡: ä¸»ç­† / å°é«”: èºæ—‹ä¿¡ä»°è£ç½®';
  } else {
    document.getElementById('lab-title').textContent = 'Spiral Lab';
    document.getElementById('lab-sub').textContent = 'Operator: Rec Dungeons';
  }

  fragLoader(lang);
};

// ç”¨æ–¼ç§»å‹•ç«¯æŒ‰éˆ•ğŸ”˜å±•é–‹ / æ”¶èµ·æ§åˆ¶
// tag æŒ‰éˆ•é‚è¼¯
document.getElementById('toggleTag').onclick = () => {
  const tagMenu = document.getElementById('tagMenu');
  const timeMenu = document.getElementById('timeMenu');

  timeMenu.style.display = 'none'; // â›” é»ğ–¤˜æ™‚è‡ªå‹•é—œ â²ï¸

  tagMenu.style.display = tagMenu.style.display === 'none' ? 'block' : 'none';
  tagMenu.innerHTML = '';

  const allTags = new Set();
  cardData.forEach(card => card.tags.forEach(t => allTags.add(t)));
  allTags.forEach(tag => {
    const btn = document.createElement('button');
    btn.textContent = tag;
    btn.dataset.tag = tag;
    btn.className = activeTags.has(tag) ? 'active' : '';
    btn.onclick = () => {
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        btn.classList.remove('active');
      } else {
        activeTags.add(tag);
        btn.classList.add('active');
      }
      renderCards();
    };
    tagMenu.appendChild(btn);
  });
};


document.getElementById('toggleTime').onclick = () => {
  const timeMenu = document.getElementById('timeMenu');
  timeMenu.style.display = timeMenu.style.display === 'none' ? 'block' : 'none';
  timeMenu.innerHTML = '';
  cardData.forEach(card => {
    const link = document.createElement('div');
    link.textContent = `${card.epoch || '???'} â†’ ${card.id}`;  // âœ… ä½¿ç”¨ Epoch
    link.style.cursor = 'pointer';
    link.onclick = () => {
      document.getElementById(card.id).scrollIntoView({ behavior: 'smooth' });
    };
    timeMenu.appendChild(link);
  });
};


// ğŸš€ å•Ÿå‹•é é¢ï¼šç¬¬ä¸€æ¬¡æ¸²æŸ“
renderCards();
</script>
</body>
</html>
